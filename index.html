<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Horror Studio</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:radial-gradient(circle at top,#111827,#020617);
  color:#e5e7eb;
}
.app{
  max-width:420px;
  min-height:100vh;
  margin:auto;
  display:flex;
  flex-direction:column;
}
header{
  padding:20px;
  font-size:22px;
  font-weight:700;
  background:linear-gradient(180deg,#020617,#020617cc);
  border-bottom:1px solid #1f2933;
}
main{
  flex:1;
  padding:20px;
}
.btn{
  background:#020617;
  border:1px solid #334155;
  color:#e5e7eb;
  padding:12px 16px;
  border-radius:10px;
  margin:6px 0;
  cursor:pointer;
  width:100%;
}
.btn:hover{border-color:#60a5fa}
.card{
  border:1px solid #1f2933;
  border-radius:14px;
  padding:16px;
  margin-top:12px;
  background:linear-gradient(160deg,#020617,#020617aa);
}
input,textarea{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  background:#020617;
  border:1px solid #334155;
  color:#e5e7eb;
}
textarea{min-height:120px}
.small{opacity:.7;font-size:14px}
.chat{
  margin-top:16px;
  line-height:1.4;
}
.genre button{
  width:auto;
  margin-right:6px;
}
</style>
</head>

<body>
<div class="app">
<header>Chat Horror Studio</header>
<main id="screen"></main>
</div>

<script>
let stories = JSON.parse(localStorage.getItem("stories") || "[]");

function save(){
  localStorage.setItem("stories", JSON.stringify(stories));
}

function renderHome(){
  const s = document.getElementById("screen");
  s.innerHTML = `
    <button class="btn" onclick="newStory()">➕ Новая история</button>
    ${stories.length === 0 ? "<p class='small'>Историй пока нет</p>" : ""}
    ${stories.map((st,i)=>`
      <div class="card">
        <b>${st.title}</b>
        <div class="small">${st.genre} • ${st.characters.length} персонажа</div>
        <button class="btn" onclick="playStory(${i})">▶ Играть</button>
      </div>
    `).join("")}
  `;
}

function newStory(){
  document.getElementById("screen").innerHTML = `
    <h3>Название истории</h3>
    <input id="title">

    <h3>Жанр</h3>
    <div class="genre">
      <button class="btn" onclick="setGenre('Хоррор')">Хоррор</button>
      <button class="btn" onclick="setGenre('Мистика')">Мистика</button>
      <button class="btn" onclick="setGenre('Триллер')">Триллер</button>
      <button class="btn" onclick="setGenre('Детектив')">Детектив</button>
    </div>
    <div id="genreLabel" class="small"></div>

    <h3>Персонажи</h3>
    <input id="charName" placeholder="Имя персонажа">
    <button class="btn" onclick="addChar()">Добавить персонажа</button>
    <ul id="charList"></ul>

    <h3>История</h3>
    <textarea id="text" placeholder="Каждая реплика с новой строки"></textarea>

    <button class="btn" onclick="createStory()">Создать карточку</button>
    <button class="btn" onclick="renderHome()">← Назад</button>
  `;
  window.genre = "";
  window.chars = [];
}

function setGenre(g){
  genre = g;
  document.getElementById("genreLabel").innerText = "Выбран жанр: " + g;
}

function addChar(){
  const input = document.getElementById("charName");
  if(!input.value) return;
  chars.push(input.value);
  document.getElementById("charList").innerHTML = chars.map(c=>`<li>${c}</li>`).join("");
  input.value="";
}

function createStory(){
  const title = document.getElementById("title").value;
  const text = document.getElementById("text").value;
  if(!title || !genre || !text) return alert("Заполни всё");

  stories.push({
    title,
    genre,
    characters: chars,
    text
  });
  save();
  renderHome();
}

function playStory(i){
  const st = stories[i];
  const s = document.getElementById("screen");
  const lines = st.text.split("\n").filter(l=>l.trim());
  let idx = 0;

  s.innerHTML = `
    <button class="btn" onclick="renderHome()">← Назад</button>
    <h3>${st.title}</h3>
    <div class="small">${st.genre}</div>
    <div id="chat" class="chat"></div>
    <button id="next" class="btn">Далее</button>
  `;

  const chat = document.getElementById("chat");
  document.getElementById("next").onclick = ()=>{
    if(idx < lines.length){
      chat.innerHTML += lines[idx] + "<br><br>";
      idx++;
    }
  };
}

renderHome();
</script>
</body>
</html>
