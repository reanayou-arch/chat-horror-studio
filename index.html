<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Horror Story</title>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: radial-gradient(circle, #0b1220, #05070d);
  color: white;
}

header {
  padding: 20px;
  font-size: 28px;
  font-weight: bold;
}

#chat {
  padding: 15px;
  height: 65vh;
  overflow-y: auto;
}

.msg {
  display: inline-block;
  padding: 12px 16px;
  border-radius: 18px;
  margin: 8px 0;
  max-width: 75%;
  word-wrap: break-word;
}

.me {
  background: #2563eb;
  margin-left: auto;
  text-align: right;
}

.npc {
  background: rgba(255,255,255,0.08);
}

.row {
  display: flex;
  gap: 10px;
  align-items: flex-end;
}

.avatar {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  object-fit: cover;
}

.name {
  font-size: 13px;
  opacity: 0.6;
  margin-bottom: 3px;
}

#inputArea {
  position: fixed;
  bottom: 0;
  width: 100%;
  display: flex;
  padding: 10px;
  background: rgba(0,0,0,0.3);
}

input {
  flex: 1;
  padding: 14px;
  border-radius: 14px;
  border: none;
  font-size: 16px;
}

button {
  margin-left: 10px;
  padding: 14px 18px;
  border: none;
  border-radius: 14px;
  background: #22c55e;
  color: white;
  font-size: 18px;
}
</style>
</head>

<body>

<header>–ü–∞–ª–∞—Ç–æ—á–Ω—ã–π —É–∂–∞—Å ‚Äî —á–∞—Ç</header>

<div id="chat"></div>

<div id="inputArea">
  <input id="text" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
  <button onclick="send()">‚û§</button>
</div>

<script>
/* === –°–Æ–ñ–ï–¢ (–∞–≤—Ç–æ—Ä –∑–∞–¥–∞—ë—Ç –æ—Å–Ω–æ–≤—É) === */

let storyContext = `
–¢—ã –≤ —Ö–æ—Ä—Ä–æ—Ä-—á–∞—Ç–µ "–ü–∞–ª–∞—Ç–æ—á–Ω—ã–π —É–∂–∞—Å".
–ì–ª–∞–≤–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏:
- –õ–µ–Ω–∞: –ª—É—á—à–∞—è –ø–æ–¥—Ä—É–≥–∞, —Ç—Ä–µ–≤–æ–∂–Ω–∞—è
- –î–∏–º–∞: –¥—Ä—É–≥, –ø–æ–¥–æ–∑—Ä–µ–≤–∞–µ—Ç –æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ò—Å—Ç–æ—Ä–∏—è: –∑–∞–≤—Ç—Ä–∞ –æ–Ω–∏ –µ–¥—É—Ç –≤ –ª–∞–≥–µ—Ä—å, –Ω–æ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫.
–û—Ç–≤–µ—á–∞–π –∫–∞–∫ –∂–∏–≤–æ–π —á–µ–ª–æ–≤–µ–∫, –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ.
`;

/* === –ü–µ—Ä—Å–æ–Ω–∞–∂–∏ === */

let characters = {
  "–õ–µ–Ω–∞": { avatar: "https://i.imgur.com/1X6R0.jpg" },
  "–î–∏–º–∞": { avatar: "https://i.imgur.com/UYiroys.jpg" }
};

/* === –ù–∞—á–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–∏ === */

addNPC("–õ–µ–Ω–∞", "–ü—Ä–∏–≤–µ—Ç... —Ç—ã —É–∂–µ —Å–æ–±—Ä–∞–ª –≤–µ—â–∏?");
addNPC("–î–∏–º–∞", "–ó–∞–≤—Ç—Ä–∞ –ª–∞–≥–µ—Ä—å. –£ –º–µ–Ω—è –ø–ª–æ—Ö–æ–µ –ø—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏–µ...");

/* === –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π === */

function addPlayer(text) {
  let chat = document.getElementById("chat");

  let bubble = document.createElement("div");
  bubble.className = "msg me";
  bubble.innerText = text;

  chat.appendChild(bubble);
  chat.scrollTop = chat.scrollHeight;
}

function addNPC(name, text) {
  let chat = document.getElementById("chat");

  let row = document.createElement("div");
  row.className = "row";

  let img = document.createElement("img");
  img.className = "avatar";
  img.src = characters[name]?.avatar || "";

  let box = document.createElement("div");

  let n = document.createElement("div");
  n.className = "name";
  n.innerText = name;

  let bubble = document.createElement("div");
  bubble.className = "msg npc";
  bubble.innerText = text;

  box.appendChild(n);
  box.appendChild(bubble);

  row.appendChild(img);
  row.appendChild(box);

  chat.appendChild(row);
  chat.scrollTop = chat.scrollHeight;
}

/* === –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–≥—Ä–æ–∫–∞ === */

async function send() {
  let input = document.getElementById("text");
  let message = input.value.trim();
  if (!message) return;

  addPlayer(message);
  input.value = "";

  addNPC("...", "–ø–µ—á–∞—Ç–∞–µ—Ç...");

  try {
    let res = await fetch("https://chat-horror-api.onrender.com/chat", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        message: storyContext + "\n–ò–≥—Ä–æ–∫: " + message
      })
    });

    let data = await res.json();

    document.querySelector(".name:last-of-type").innerText = "–õ–µ–Ω–∞";
    document.querySelector(".npc:last-of-type").innerText = data.reply;

  } catch {
    addNPC("–û—à–∏–±–∫–∞", "–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç üò¢");
  }
}
</script>

</body>
</html>
