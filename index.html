<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Horror Studio</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  color:#fff;
  transition:0.6s;
}

.app{
  max-width:420px;
  margin:auto;
  height:100vh;
  display:flex;
  flex-direction:column;
}

.header{
  padding:16px;
  font-size:20px;
  font-weight:700;
  background:rgba(0,0,0,0.6);
}

.screen{
  flex:1;
  padding:16px;
  overflow-y:auto;
}

.card{
  background:rgba(0,0,0,0.55);
  padding:14px;
  border-radius:14px;
  margin-bottom:12px;
}

input{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:none;
  margin-top:6px;
}

button{
  margin-top:10px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:14px;
  background:#2563eb;
  color:white;
  font-size:15px;
}

.chat{
  display:flex;
  flex-direction:column;
  gap:12px;
}

.message{
  display:flex;
  gap:8px;
}

.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
}

.bubble{
  background:rgba(30,30,40,0.7);
  padding:10px 14px;
  border-radius:16px;
  max-width:75%;
}

.name{
  font-size:12px;
  opacity:.7;
  margin-bottom:4px;
}

.player{
  justify-content:flex-end;
}

.player .bubble{
  background:rgba(34,197,94,0.85);
}

.system .bubble{
  background:rgba(120,120,120,0.4);
}

.typing{
  opacity:.5;
  font-size:13px;
}
</style>
</head>

<body>
<div class="app">
  <div class="header">Chat Horror Studio</div>
  <div class="screen" id="screen"></div>
</div>

<script>
let –ø–µ—Ä—Å–æ–Ω–∞–∂–∏=[];
let —Ä–µ–∂–∏–º="editor";
let autoTimer=null;
let eventTimer=null;
let currentScene="school";

/* === –°–¶–ï–ù–´ === */
const scenes={
  school:{
    name:"üè´ –®–∫–æ–ª–∞",
    bg:"linear-gradient(#1e3a8a,#0b1220)",
    events:[
      "üì¢ –í –∫–æ—Ä–∏–¥–æ—Ä–µ –∫—Ç–æ-—Ç–æ —Å–º–µ—ë—Ç—Å—è...",
      "üìì –ê–ª–∏–Ω–∞: –û–ø—è—Ç—å —ç—Ç–∞ —à–∫–æ–ª–∞ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç.",
      "üëÄ –ú–∞–∫—Å: –¢—ã –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –∑–∞ –Ω–∞–º–∏ —Å–º–æ—Ç—Ä—è—Ç?"
    ]
  },
  camp:{
    name:"üå≤ –õ–∞–≥–µ—Ä—å –Ω–æ—á—å—é",
    bg:"linear-gradient(#052e16,#000)",
    events:[
      "üî• –ö–æ—Å—Ç—ë—Ä –ø–æ—á—Ç–∏ –ø–æ–≥–∞—Å...",
      "üåô –°–∞—à–∞: –ó–¥–µ—Å—å —Å–ª–∏—à–∫–æ–º —Ç–∏—Ö–æ.",
      "üò® –ö—Ç–æ-—Ç–æ —Ö–æ–¥–∏—Ç –º–µ–∂–¥—É –ø–∞–ª–∞—Ç–∫–∞–º–∏..."
    ]
  },
  forest:{
    name:"üå´ –õ–µ—Å",
    bg:"linear-gradient(#064e3b,#020617)",
    events:[
      "üçÇ –í–µ—Ç–∫–∏ —Ö—Ä—É—Å—Ç—è—Ç —Å–∞–º–∏ –ø–æ —Å–µ–±–µ...",
      "üëÅ –ö–∞–∂–µ—Ç—Å—è, –∫—Ç–æ-—Ç–æ —Ä—è–¥–æ–º.",
      "üï≥ –¢—Ä–æ–ø–∞ –∏—Å—á–µ–∑–∞–µ—Ç –≤–æ —Ç—å–º–µ."
    ]
  }
};

/* === –ü–ê–ù–ï–õ–¨ === */
function showEditor(){
  —Ä–µ–∂–∏–º="editor";
  clearInterval(autoTimer);
  clearInterval(eventTimer);

  screen.innerHTML=`
    <div class="card">
      <h3>üé¨ –í—ã–±–µ—Ä–∏ —Å—Ü–µ–Ω—É</h3>
      <button onclick="setScene('school')">üè´ –®–∫–æ–ª–∞</button>
      <button onclick="setScene('camp')">üå≤ –õ–∞–≥–µ—Ä—å</button>
      <button onclick="setScene('forest')">üå´ –õ–µ—Å</button>
    </div>

    <div class="card">
      <h3>üë• –ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h3>
      <input id="charName" placeholder="–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞">
      <input id="charRole" placeholder="–•–∞—Ä–∞–∫—Ç–µ—Ä (—Å—Ç–µ—Ä–≤–∞, –º–∞—á–æ...)">
      <button onclick="addChar()">–î–æ–±–∞–≤–∏—Ç—å</button>
      <div id="charList"></div>
    </div>

    <button onclick="startGame()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–∞—Ç</button>
  `;
  renderCharList();
}

/* === –°–¶–ï–ù–ê === */
function setScene(id){
  currentScene=id;
  document.body.style.background=scenes[id].bg;
}

/* === –î–û–ë–ê–í–ò–¢–¨ === */
function addChar(){
  const name=document.getElementById("charName").value.trim();
  const role=document.getElementById("charRole").value.trim();
  if(!name||!role) return alert("–ó–∞–ø–æ–ª–Ω–∏");

  –ø–µ—Ä—Å–æ–Ω–∞–∂–∏.push({
    name,role,color:randomColor()
  });

  document.getElementById("charName").value="";
  document.getElementById("charRole").value="";
  renderCharList();
}

function renderCharList(){
  const list=document.getElementById("charList");
  if(!list) return;
  list.innerHTML=–ø–µ—Ä—Å–æ–Ω–∞–∂–∏.map(p=>`
    <div style="margin-top:8px">
      <b>${p.name}</b> ‚Äî ${p.role}
    </div>
  `).join("");
}

/* === –ó–ê–ü–£–°–ö === */
function startGame(){
  if(–ø–µ—Ä—Å–æ–Ω–∞–∂–∏.length<2) return alert("–ù—É–∂–Ω–æ 2 –ø–µ—Ä—Å–æ–Ω–∞–∂–∞");

  —Ä–µ–∂–∏–º="game";
  screen.innerHTML=`
    <button onclick="showEditor()">‚Üê –ù–∞–∑–∞–¥</button>
    <div class="card">–°—Ü–µ–Ω–∞: ${scenes[currentScene].name}</div>
    <div class="chat" id="chat"></div>

    <div style="display:flex;gap:6px;margin-top:12px">
      <input id="msg" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." style="flex:1">
      <button onclick="send()" style="width:auto">‚ñ∂</button>
    </div>
  `;

  addSystem("–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∞–ª–∞—Å—å...");

  autoTimer=setInterval(autoTalk,7000);
  eventTimer=setInterval(runEvent,10000);
}

/* === –°–û–û–ë–©–ï–ù–ò–Ø === */
function addMessage(name,text,color,isPlayer=false){
  chat.innerHTML+=`
    <div class="message ${isPlayer?"player":""}">
      ${isPlayer?"":`<div class="avatar" style="background:${color}">${name[0]}</div>`}
      <div class="bubble">
        <div class="name">${name}</div>
        ${text}
      </div>
    </div>
  `;
  chat.scrollTop=99999;
}

function addSystem(text){
  chat.innerHTML+=`
    <div class="message system">
      <div class="bubble">${text}</div>
    </div>
  `;
}

/* === –ò–ì–†–û–ö === */
function send(){
  const t=document.getElementById("msg").value.trim();
  if(!t) return;
  document.getElementById("msg").value="";
  addMessage("–í—ã",t,"",true);
}

/* === –ê–í–¢–û–î–ò–ê–õ–û–ì === */
function autoTalk(){
  const a=–ø–µ—Ä—Å–æ–Ω–∞–∂–∏[Math.floor(Math.random()*–ø–µ—Ä—Å–æ–Ω–∞–∂–∏.length)];
  const b=–ø–µ—Ä—Å–æ–Ω–∞–∂–∏[Math.floor(Math.random()*–ø–µ—Ä—Å–æ–Ω–∞–∂–∏.length)];

  addMessage(a.name,`${b.name}, —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å —ç—Ç–æ?..`,a.color);
}

/* === –°–û–ë–´–¢–ò–ï –ü–û –°–¶–ï–ù–ï === */
function runEvent(){
  const ev=scenes[currentScene].events;
  addSystem(ev[Math.floor(Math.random()*ev.length)]);
}

/* === –¶–í–ï–¢ === */
function randomColor(){
  const c=["#e11d48","#2563eb","#22c55e","#a855f7","#eab308"];
  return c[Math.floor(Math.random()*c.length)];
}

const screen=document.getElementById("screen");
let chat=null;

document.body.style.background=scenes.school.bg;

showEditor();

setTimeout(()=>{chat=document.getElementById("chat")},100);
</script>
</body>
</html>
