<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Horror Story</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:radial-gradient(circle at top,#111827,#05070d);
  color:white;
}

.header{
  padding:18px;
  font-size:24px;
  font-weight:800;
  text-align:center;
  background:rgba(0,0,0,0.4);
  border-bottom:1px solid rgba(255,255,255,0.1);
}

.chat{
  padding:15px;
  max-width:520px;
  margin:auto;
  height:calc(100vh - 140px);
  overflow-y:auto;
}

.msg{
  display:flex;
  gap:10px;
  margin:12px 0;
}

.bubble{
  background:rgba(255,255,255,0.08);
  padding:12px 14px;
  border-radius:16px;
  max-width:75%;
}

.me{
  justify-content:flex-end;
}

.me .bubble{
  background:#2563eb;
}

.name{
  font-size:13px;
  opacity:0.6;
  margin-bottom:4px;
}

.inputBox{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  padding:12px;
  display:flex;
  gap:10px;
  background:rgba(10,15,25,0.95);
  border-top:1px solid rgba(255,255,255,0.1);
}

input{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:none;
  outline:none;
  font-size:16px;
}

button{
  padding:12px 18px;
  border:none;
  border-radius:14px;
  background:#22c55e;
  font-weight:700;
  font-size:16px;
  color:white;
}

.typing{
  opacity:0.5;
  font-size:14px;
  margin:10px 0;
}
</style>
</head>

<body>

<div class="header">–ü–∞–ª–∞—Ç–æ—á–Ω—ã–π —É–∂–∞—Å ‚Äî —á–∞—Ç</div>

<div class="chat" id="chat"></div>

<div class="inputBox">
  <input id="text" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
  <button onclick="send()">‚û§</button>
</div>

<script>
/* =====================================================
   üî• –í–°–¢–ê–í–¨ –°–Æ–î–ê –°–í–û–ô Render URL
   –ü—Ä–∏–º–µ—Ä:
   https://chat-horror-api.onrender.com/chat
===================================================== */
const SERVER_URL = "https://chat-horror-api.onrender.com";


const chat = document.getElementById("chat");
const input = document.getElementById("text");


/* === –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç === */
function addMessage(name,text,isMe=false){
  const div=document.createElement("div");
  div.className="msg"+(isMe?" me":"");

  div.innerHTML=`
    <div class="bubble">
      <div class="name">${name}</div>
      ${text}
    </div>
  `;

  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}


/* === –ü–µ—á–∞—Ç–∞–µ—Ç... === */
function showTyping(){
  const t=document.createElement("div");
  t.className="typing";
  t.id="typing";
  t.innerText="–ü–µ—Ä—Å–æ–Ω–∞–∂ –ø–µ—á–∞—Ç–∞–µ—Ç...";
  chat.appendChild(t);
  chat.scrollTop=chat.scrollHeight;
}

function removeTyping(){
  const t=document.getElementById("typing");
  if(t) t.remove();
}


/* === GPT –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Render === */
async function askGPT(userText){

  const res = await fetch(SERVER_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      message:userText
    })
  });

  const data = await res.json();
  return data.reply;
}


/* === –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–≥—Ä–æ–∫–∞ === */
async function send(){
  const text=input.value.trim();
  if(!text) return;

  input.value="";

  addMessage("–í—ã",text,true);

  showTyping();

  try{
    const reply = await askGPT(text);
    removeTyping();
    addMessage("–õ–µ–Ω–∞",reply,false);

  }catch(err){
    removeTyping();
    addMessage("–û—à–∏–±–∫–∞","–°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç üò¢",false);
    console.log(err);
  }
}


/* === –°—Ç–∞—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ === */
addMessage("–õ–µ–Ω–∞","–ü—Ä–∏–≤–µ—Ç... —Ç—ã —É–∂–µ —Å–æ–±—Ä–∞–ª –≤–µ—â–∏?");
addMessage("–î–∏–º–∞","–ó–∞–≤—Ç—Ä–∞ –ª–∞–≥–µ—Ä—å. –£ –º–µ–Ω—è –ø–ª–æ—Ö–æ–µ –ø—Ä–µ–¥—á—É–≤—Å—Ç–≤–∏–µ...");
</script>

</body>
</html>
